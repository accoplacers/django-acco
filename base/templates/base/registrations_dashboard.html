{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Registrations Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="icon" href="{% static 'base/img/favicon.ico' %}" type="image/x-icon">
  <link rel="apple-touch-icon" href="{% static 'base/img/favicon.ico' %}" type="image/x-icon">

  <style>
    body {
      background: linear-gradient(to right, #1e293b, #0f172a);
      color: #f8fafc;
      font-family: 'Inter', sans-serif;
    }

    .card {
      background-color: #1e293b;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    th {
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }

    th:hover {
      background-color: #334155;
    }

    tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    .sort-indicator {
      display: inline-block;
      margin-left: 6px;
      font-size: 0.85rem;
      opacity: 0.7;
    }

    /* Responsive tweaks */
    @media (max-width: 1024px) {
      table {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.75rem;
      }
      th, td {
        padding: 0.5rem;
        font-size: 0.85rem;
      }
      .card {
        border-radius: 0.75rem;
      }
    }

    @media (max-width: 640px) {
      table {
        min-width: 800px; /* allow horizontal scroll */
      }

      .table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      th, td {
        white-space: nowrap;
      }

      .sort-indicator {
        font-size: 0.7rem;
      }
    }
  </style>
</head>

<body>
    <!-- Home Button -->
<div class="absolute top-4 left-4">
  <a href="{% url 'register_user' %}" class="bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 px-4 rounded shadow">
    Home
  </a>
</div>
  <div class="container mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <h1 class="text-3xl sm:text-4xl font-bold mb-6 sm:mb-8 text-center text-white">Employee Profiles</h1>

    <div class="card">
      <div class="table-wrapper">
        <table id="registrationTable" class="min-w-full text-sm text-left border-collapse">
          <thead class="bg-gray-800 text-gray-100">
            <tr>
              <th class="py-3 px-4">#</th>
              <th class="py-3 px-4">Name</th>
              <th class="py-3 px-4">Email</th>
              <th class="py-3 px-4">Phone</th>
              <th class="py-3 px-4">Nationality</th>
              <th class="py-3 px-4">Location</th>
              <th class="py-3 px-4">Qualification</th>
              <th id="sortExperience" class="py-3 px-4 flex items-center">
                Experience
                <span id="sortIcon" class="sort-indicator">↕</span>
              </th>
              <th class="py-3 px-4">Role</th>
              <th class="py-3 px-4">Resume</th>
            </tr>
          </thead>
          <tbody class="text-gray-200">
            {% for reg in registrations %}
            <tr class="border-b border-gray-700 transition">
              <td class="py-3 px-4">{{ forloop.counter }}</td>
              <td class="py-3 px-4 font-semibold text-white">{{ reg.name }}</td>
              <td class="py-3 px-4">{{ reg.email }}</td>
              <td class="py-3 px-4">{{ reg.phone }}</td>
              <td class="py-3 px-4">{{ reg.nationality }}</td>
              <td class="py-3 px-4">{{ reg.location }}</td>
              <td class="py-3 px-4">{{ reg.qualification }}</td>
              <td class="py-3 px-4">{{ reg.experience }}</td>
              <td class="py-3 px-4">{{ reg.role }}</td>
              <td class="py-3 px-4">
                {% if reg.resume %}
                  <a href="{{ reg.resume.url }}" target="_blank" class="text-blue-400 hover:text-blue-300 underline">View</a>
                {% else %}
                  <span class="text-gray-500">No file</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="10" class="py-4 text-center text-gray-400">No registrations found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const table = document.getElementById("registrationTable");
      const tbody = table.querySelector("tbody");
      const rows = Array.from(tbody.querySelectorAll("tr"));
      const sortBtn = document.getElementById("sortExperience");
      const sortIcon = document.getElementById("sortIcon");

      let sortState = 0; // 0 = default, 1 = asc, 2 = desc
      const defaultRows = [...rows];

      sortBtn.addEventListener("click", () => {
        sortState = (sortState + 1) % 3;

        let sortedRows = [];
        if (sortState === 0) {
          sortedRows = defaultRows;
          sortIcon.textContent = "↕";
        } else if (sortState === 1) {
          sortedRows = [...rows].sort((a, b) => {
            const aVal = a.children[7].textContent.trim();
            const bVal = b.children[7].textContent.trim();
            return extractExperienceValue(aVal) - extractExperienceValue(bVal);
          });
          sortIcon.textContent = "↑";
        } else {
          sortedRows = [...rows].sort((a, b) => {
            const aVal = a.children[7].textContent.trim();
            const bVal = b.children[7].textContent.trim();
            return extractExperienceValue(bVal) - extractExperienceValue(aVal);
          });
          sortIcon.textContent = "↓";
        }

        tbody.innerHTML = "";
        sortedRows.forEach(row => tbody.appendChild(row));
      });

      function extractExperienceValue(val) {
        if (!val) return 0;
        val = val.toLowerCase().replace("+", "");
        if (val.includes("-")) {
          return parseFloat(val.split("-")[0]);
        }
        const num = parseFloat(val);
        return isNaN(num) ? 0 : num;
      }
    });
  </script>
</body>
</html>
